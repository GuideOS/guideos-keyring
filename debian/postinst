#!/bin/sh
set -e

case "$1" in
    configure)
        # Remove old keyring files if they exist
        rm -f /usr/share/keyrings/home_guideos_cinnamon-trixie.gpg
        rm -f /usr/share/keyrings/home_guideos_trixie.gpg
        rm -f /usr/share/keyrings/home_guideos_universe.gpg
        
        # Remove old sources.list files that reference the old keyrings
        find /etc/apt/sources.list.d/ -type f \( -name "*guideos*.list" -o -name "*home_guideos*.list" \) -delete 2>/dev/null || true
        
        # Remove old sources files with old Signed-By paths
        for file in /etc/apt/sources.list.d/*.sources; do
            if [ -f "$file" ] && grep -q "/usr/share/keyrings/home_guideos" "$file" 2>/dev/null; then
                rm -f "$file"
            fi
        done
        
        # Update apt cache to recognize the new repository
        if [ -x /usr/bin/apt-get ]; then
            echo "GuideOS keyring installed. Old configuration cleaned up."
            echo "Run 'apt update' to refresh package lists."
        fi
        ;;
    
    abort-upgrade|abort-remove|abort-deconfigure)
        # Nothing to do
        ;;
    
    *)
        echo "postinst called with unknown argument \`$1'" >&2
        exit 1
        ;;
esac

#DEBHELPER#

exit 0
